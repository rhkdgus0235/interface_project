{% extends 'base.html' %} 
{% load pybo_filter %}
{% block content %}
<div class="container my-3">
  <div class="row justify-content-between my-3">
    <div class="col-2"><i class='fas fa-sort'>정렬방법</i>
      <select class="form-control so">
        <option value="recent" {% if so == 'recent' %}selected{% endif %}>
          RESENT
        </option>
        <option value="recommend" {% if so == 'recommend' %}selected{% endif %}>
          BEST
        </option>
        <option value="popular" {% if so == 'popular' %}selected{% endif %}>
          HOT
        </option>
        <option value="most" {% if so == 'most' %}selected{% endif %}>
          VIEW
        </option>
      </select>
    </div>
    <div class="col-4 input-group">
      <input type="text" class="form-control kw"
            value="{{kw|default_if_none:''}}">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" id="btn_search">search</button>
      </div>
    </div>
  </div>
  <table class="table table-hover">
    <thead>
      <tr class="text-center thead-dark">
        <th>No.</th>
        <th>Up</th>
        <th style="width:50%">Title</th>
        <th>Writer</td>
        <th>작성일시</th>
        <th><i class="fas fa-eye"></i>
      </tr>
    </thead>
    <tbody>
      {% if question_list %} 
      {% for question in question_list %}
      <tr class ="text-center">
        <td>{{ question_list.paginator.count|sub:question_list.start_index|sub:forloop.counter0|add:1 }}</td>
        <td>
          {% if question.voter.all.count > 0 %}
          <span class-"badge badge-warning px-2 py-1">
            {{ question.voter.all.count }}
          </span>
          {% endif %}
        </td>
        <td class="text-left">
          <a href="{% url 'pybo:detail' question.id %}"> {{ question.subject }}</a>
          {% if question.answer_set.count > 0 %}
          <span class="text=danger small ml-2">
            ({{question.answer_set.count }})
          </span>
          {% endif %}
        </td>
        <td>{{ question.author.username }}</td>
        <td>{{ question.create_date | date:'Y-m-d' }}</td>
        <td>{{ question.hit }}</td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="3">질문이 없습니다.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>
  <ul class="pagination justify-content-center">
    {% if question_list.has_previous %}
    <li class="page-item">
      <a class="page-link" data-page="{{ question_list.previous_page_number }}" href="#">Pre</a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" tabindex="-1" aria-disabled="true" href="#"> Pre</a>
    </li>
    {% endif %} {% for page_number in question_list.paginator.page_range %}
    {% if page_number >= question_list.number|add:-5 and page_number <= question_list.number|add:5 %} 
    {% if page_number == question_list.number %}
    <li class="page-item active" aria-current="page">
      <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
    </li>
    {% else %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
    </li>
    {% endif %} {% endif %} {% endfor %} {% if question_list.has_next %}
    <li class="page-item">
      <a class="page-link" data-page="{{ question_list.next_page_number }} "href="#">Next</a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" tabindex="-1" aria-disabled="true" href="#">Next</a>
    </li>
    {% endif %}
  </ul>

  <a href="{% url 'pybo:question_create' %}" class="btn btn-outline-primary"><i class='fas fa-plus'></i>질문</a>
</div>
<form id="searchForm" method="get" action="{% url 'index' %}">
    <input type="hidden" id="kw" name="kw" value="{{kw|default_if_none:'' }}">
    <input type="hidden" id="page" name="page" value="{{page}}">
    <input type="hidden" id="so" name="so" value="{{ so }}">
</form>
{% endblock %}
{% block script %}
<script type='text/javascript'>
$(document).ready(function(){
  $(".page-link").on('click',function(){
    $("#page").val($(this).data("page"));
    $("#searchForm").submit(); 
   });

   $("#btn_search").on('click', function(){
     $("#kw").val($(".kw").val());
     $("#page").val(1);
     $("#searchForm").submit();
   });

   $(".so").on('change', function(){
     $("#so").val($(this).val());
     $("#page").val(1);
     $("#searchForm").submit();
   });
})
</script>
{% endblock %}